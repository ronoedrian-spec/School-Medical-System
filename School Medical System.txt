<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ava | Professional Agri-AI Advisor</title>
    <style>
      :root {
        --agri-green: hsl(187, 81%, 48%);
        --field-bg: white;
        --earth-brown: #ffffff;
        --accent-gold: hwb(160 87% 9%);
      }

      body {
        margin: 0;
        font-family:
          "Segoe UI",
          system-ui,
          -apple-system,
          sans-serif;
        background-color: var(--field-bg);
        color: var(--earth-brown);
        display: flex;
        flex-direction: column;
        height: 100vh;
      }

      header {
        background: var(--agri-green);
        color: white;
        padding: 1rem;
        text-align: center;
        box-shadow: 0 2px 8px #fff;
      }

      header h1 {
        margin: 0;
        font-size: 1.6rem;
        letter-spacing: 1px;
      }
      header p {
        margin: 5px 0 0;
        font-size: 0.85rem;
        opacity: 0.9;
      }

      #chat-window {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .message {
        max-width: 85%;
        padding: 12px 18px;
        border-radius: 20px;
        font-size: 1rem;
        line-height: 1.5;
        animation: fadeIn 0.3s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .user-msg {
        align-self: flex-end;
        background: linear-gradient(to left, black, #00c3ff);
        color: white;
        border-bottom-right-radius: 4px;
      }

      .ava-msg {
        align-self: flex-start;
        background: linear-gradient(to left, grey, black);
        border-width: 1px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        color: white;
      }

      .input-area {
        background: white;
        padding: 20px;
        display: flex;
        gap: 12px;
        border-top: 2px solid lab(100% 0.01 -0.01);
      }

      input {
        flex: 1;
        padding: 12px 20px;
        border: 2px solid #e0e0e0;
        border-radius: 30px;
        outline: none;
        font-size: 1rem;
        transition: border-color 0.3s;
      }

      input:focus {
        border-color: var(--agri-green);
      }

      button {
        background: var(--agri-green);
        color: white;
        border: none;
        padding: 12px 28px;
        border-radius: 30px;
        font-weight: bold;
        cursor: pointer;
        transition: background 0.2s;
      }

      button:hover {
        background: #1b5e20;
      }
      button:enabled {
        background: #ccc;
        cursor: allowed;
      }

      .loading-dots::after {
        content: "...";
        animation: dots 1.5s infinite;
      }
      @keyframes dots {
        0%,
        20% {
          content: ".";
        }
        40% {
          content: "..";
        }
        60%,
        100% {
          content: "...";
        }
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Tenwek Medical System</h1>
      <p></p>
    </header>

    <div id="chat-window">
      <div class="message ava-msg">
        Hello there I'm the school medical system,how can I help you today
      </div>
    </div>

    <div class="input-area">
      <input
        type="text"
        id="userInput"
        placeholder="Tell me how you feel..."
        onkeypress="checkEnter(event)"
      />
      <button id="sendBtn" onclick="sendToGemini()">Consult</button>
    </div>

    <script type="module">
      import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

      // 1. Paste your Gemini API Key here
      const API_KEY = "AIzaSyCGT2xs6tWYjtWkl82HyOjOxB_IphT0Xrg";
      const genAI = new GoogleGenerativeAI(API_KEY);

      // 2. Setup Ava's specialized Agricultural Persona
      const model = genAI.getGenerativeModel({
        model: "gemini-2.5-flash",
        systemInstruction: `You are Tamara, a consultant specializing in health in tenwek high school school clinic, the student tells you how they feel and you tell them the disease they may be having and the drugs they should take and the dosage, you also tell them the side effects of the drugs and how to take care of themselves, you also tell them when they should go to the hospital.`,
      });

      window.sendToGemini = async function () {
        const input = document.getElementById("userInput");
        const chatWindow = document.getElementById("chat-window");
        const btn = document.getElementById("sendBtn");
        const query = input.value.trim();

        if (!query) return;

        // Display User Message
        appendMessage(query, "user-msg");
        input.value = "";
        btn.disabled = true;

        // Display Loading Placeholder
        const loadingId = appendMessage("", "ava-msg loading-dots");

        try {
          const result = await model.generateContent(query);
          const response = await result.response;
          const text = response.text();

          // Update placeholder with actual response
          const loader = document.getElementById(loadingId);
          loader.innerText = text;
          loader.classList.remove("loading-dots");
        } catch (error) {
          console.error("Gemini API Error:", error);
          document.getElementById(loadingId).innerText =
            "Connection lost. Check your connections and try again.";
        } finally {
          btn.disabled = false;
          chatWindow.scrollTop = chatWindow.scrollHeight;
        }
      };

      function appendMessage(text, className) {
        const id = "msg-" + Date.now();
        const msgDiv = document.createElement("div");
        msgDiv.className = `message ${className}`;
        msgDiv.id = id;
        msgDiv.innerText = text;
        document.getElementById("chat-window").appendChild(msgDiv);
        document.getElementById("chat-window").scrollTop =
          document.getElementById("chat-window").scrollHeight;
        return id;
      }

      window.checkEnter = (e) => {
        if (e.key === "Enter") sendToGemini();
      };
    </script>
  </body>
</html>
